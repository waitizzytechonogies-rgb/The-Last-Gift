<div *ngIf="person; else loading">
  <!-- Header -->
  <section class="relative">
    <div
      class="h-[80px] shadow bg-[var(--primary)] flex items-center justify-between px-6 text-[var(--secondary)]"
    >
      <div class="flex items-center">
        <img src="../../assets/logo.png" alt="Memories logo" class="w-20" />
        <span class="font-bold text-2xl">Memories</span> &nbsp;
        <span class="text-[#e6007e] font-bold text-2xl">.</span>
      </div>
      <div class="hidden md:flex lg:flex gap-8 items-center justify-between">
        <span class="cursor-pointer">Create memory with your loved one</span>
        <span class="cursor-pointer">Contact</span>
        <span class="cursor-pointer">About</span>
        <span class="cursor-pointer">Download QR</span>
      </div>
    </div>
  </section>

  <!-- Main container -->
  <div class="min-h-screen bg-[var(--secondary)] text-white font-sans">
    <!-- <div
      class="absolute flex items-center justify-end right-5 top-24"
      *ngIf="isLoggedIn"
    >
      <button
        type="button"
        class="border p-2 rounded w-[100px]"
        (click)="edit()"
      >
        Edit
      </button>
    </div> -->
    <div class="min-h-screen flex items-center justify-center">
      <div class="max-w-7xl w-4/5 mt-12 md:-mt-6">
        <!-- HERO: Edit toolbar appears at the top-right of the hero when logged in -->
        <section
          class="relative min-h-screen grid grid-cols-1 md:grid-cols-2 gap-8 items-center"
        >
          <!-- LEFT: Text content (editable fields shown when editMode) -->
          <div class="flex flex-col justify-center md:pr-8 z-10">
            <p class="text-[1.5rem] font-light italic opacity-90">
              Our beloved,
            </p>

            <p class="leading-[1] text-[4.5rem] font-extrabold mt-2">
              <span class="block" style="font-family: 'Parisienne', cursive">{{
                name
              }}</span>
            </p>

            <blockquote
              class="mt-6 text-[1.8rem] italic border-black border-l-4 pl-4 max-w-xl"
            >
              <span>{{ caption }}</span>
              <!-- <span
                >Love was her profession — She taught it, lived it, and left it
                with us.</span 
              >-->
            </blockquote>
          </div>

          <!-- RIGHT: Larger portrait without frame -->
          <div class="flex justify-center md:justify-end">
            <!-- When editing, show live preview with slightly larger size -->
            <img
              [src]="[imageSrc || '../../assets/meeka-latest.jpeg']"
              alt="{{ name }}"
              class="w-80 md:w-[520px] h-[640px] md:h-[700px] object-cover rounded-2xl shadow-2xl"
            />
          </div>
        </section>

        <!-- About -->
        <div>
          <h3 class="text-2xl mb-4">About Her Life</h3>
          <section
            class="mt-12 bg-[var(--primary)] text-[var(--secondary)] p-8 rounded-lg text-white"
          >
            <!-- <h2 class="text-3xl mb-4 text-black" >About Her Life</h2> -->
            <p class="leading-relaxed text-[var(--secondary)]">
              {{ aboutText }}
            </p>
          </section>
        </div>

        <!-- Testimonials -->
        <section class="mt-8 text-white" *ngIf="testimonials?.length">
          <h3 class="text-2xl mb-4">Our memories of her</h3>
          <div class="relative">
            <!-- Carousel wrapper -->
            <div
              class="overflow-hidden rounded-lg"
              (mouseenter)="stopAuto()"
              (mouseleave)="startAuto()"
            >
              <div
                class="flex transition-transform duration-500 ease-in-out"
                [style.transform]="'translateX(-' + currentIndex * 100 + '%)'"
                (touchstart)="onTouchStart($event)"
                (touchmove)="onTouchMove($event)"
                (touchend)="onTouchEnd()"
              >
                <!-- Each testimonial -->
                <div
                  *ngFor="let t of testimonials"
                  class="w-full flex-shrink-0 p-12 bg-[var(--primary)] text-[var(--secondary)] min-h-[180px] flex flex-col justify-center"
                  aria-live="polite"
                >
                  <p
                    class="text-lg md:text-xl italic whitespace-pre-wrap break-words leading-relaxed"
                  >
                    “{{ t.message }}”
                  </p>

                  <div class="flex items-center justify-end">
                    <p class="mt-4 text-sm font-medium break-words">
                      — {{ t.author
                      }}{{ t.relationShip ? ", " + t.relationShip : "" }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prev / Next Buttons -->
            <button
              (click)="prev()"
              class="absolute left-2 top-[45%] -translate-y-1/2 bg-white/10 hover:bg-white/20 text-white p-2 rounded-full"
              aria-label="Previous testimonial"
              type="button"
            >
              ‹
            </button>

            <button
              (click)="next()"
              class="absolute right-2 top-[45%] -translate-y-1/2 bg-white/10 hover:bg-white/20 text-white p-2 rounded-full"
              aria-label="Next testimonial"
              type="button"
            >
              ›
            </button>

            <!-- Dots + View fullscreen -->
            <div class="flex justify-center gap-2 mt-4 items-center">
              <div class="flex gap-2">
                <button
                  *ngFor="let _ of testimonials; let i = index"
                  (click)="goTo(i)"
                  [ngClass]="{
                    'bg-primary': i === currentIndex,
                    'bg-primaryLight': i !== currentIndex
                  }"
                  class="w-3 h-3 rounded-full"
                  [attr.aria-label]="'Go to testimonial ' + (i + 1)"
                  type="button"
                ></button>
              </div>

              <!-- View fullscreen -->
              <button
                (click)="openFullscreen(currentIndex)"
                class="ml-4 px-3 py-1 rounded-md bg-white/10 hover:bg-white/20 text-white text-sm"
                type="button"
                aria-label="View testimonial fullscreen"
              >
                View fullscreen
              </button>
            </div>
          </div>
        </section>

        <!-- Fullscreen overlay -->
        <div
          *ngIf="isFullscreenOpen"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4"
          role="dialog"
          aria-modal="true"
          (click)="closeFullscreen()"
        >
          <div
            (click)="$event.stopPropagation()"
            class="relative w-full h-full max-w-6xl mx-auto overflow-auto rounded-lg"
          >
            <!-- Close -->
            <button
              (click)="closeFullscreen()"
              class="absolute right-4 top-4 z-30 inline-flex items-center justify-center h-10 w-10 rounded-full bg-white/10 hover:bg-white/20 text-white"
              aria-label="Close fullscreen"
              type="button"
            >
              ✕
            </button>

            <!-- Prev -->
            <button
              (click)="prev(); $event.stopPropagation()"
              class="absolute left-4 top-1/2 z-30 -translate-y-1/2 inline-flex items-center justify-center h-12 w-12 rounded-full bg-white/10 hover:bg-white/20 text-white"
              aria-label="Previous testimonial"
              type="button"
            >
              ‹
            </button>

            <!-- Next -->
            <button
              (click)="next(); $event.stopPropagation()"
              class="absolute right-4 top-1/2 z-30 -translate-y-1/2 inline-flex items-center justify-center h-12 w-12 rounded-full bg-white/10 hover:bg-white/20 text-white"
              aria-label="Next testimonial"
              type="button"
            >
              ›
            </button>

            <!-- Fullscreen content -->
            <div
              class="w-full min-h-screen flex items-center justify-center"
              [ngStyle]="{
                'background-color': 'var(--primary, rgb(31,34,58))',
                color: 'var(--secondary, #f8fafc)'
              }"
              aria-live="polite"
            >
              <div class="max-w-4xl w-full p-12 text-center">
                <p
                  class="text-2xl md:text-3xl italic whitespace-pre-wrap break-words leading-relaxed"
                >
                  “{{ testimonials[currentIndex]?.message }}”
                </p>

                <p
                  class="mt-6 text-base md:text-lg font-medium break-words text-right"
                >
                  — {{ testimonials[currentIndex]?.author
                  }}{{
                    testimonials[currentIndex]?.relationShip
                      ? ", " + testimonials[currentIndex]?.relationShip
                      : ""
                  }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Gallery -->
        <!-- GALLERY OF MEMORIES -->
        <section class="py-8">
          <div class="flex items-center justify-between">
            <h3 class="text-2xl mb-4 text-white">Gallery of Memories</h3>
            <button
              (click)="slideshowMemories.open(0)"
              class="px-3 py-1 rounded bg-white/10 hover:bg-white/20 text-white"
            >
              Slideshow
            </button>
          </div>

          <div
            class="flex items-center gap-4 overflow-x-auto scroll-smooth snap-x snap-mandatory px-4"
          >
            <img
              *ngFor="let g of gallery; let i = index"
              [src]="'../../assets/images/meeka/' + g"
              [alt]="g"
              class="flex-shrink-0 w-80 h-80 rounded-lg object-cover snap-center transition-transform duration-300 hover:scale-105"
              (click)="slideshowMemories.open(i)"
            />
          </div>

          <!-- Slideshow for Gallery of Memories -->
          <app-gallery-slideshow
            #slideshowMemories
            [isMemory]="true"
            [images]="gallery"
            basePath="assets/images/meeka/"
          ></app-gallery-slideshow>
        </section>

        <!-- SOLO GALLERY -->
        <section class="py-8">
          <div class="flex items-center justify-between">
            <h3 class="text-2xl mb-4 text-white">
              87 years of beauty and grace
            </h3>
            <button
              (click)="slideshowSolo.open(0)"
              class="px-3 py-1 rounded bg-white/10 hover:bg-white/20 text-white"
            >
              Slideshow
            </button>
          </div>

          <div
            class="flex items-center gap-4 overflow-x-auto scroll-smooth snap-x snap-mandatory px-4"
          >
            <img
              *ngFor="let g of gallerySolo; let i = index"
              [src]="
                '../../assets/images/meeka-solo/image-' + (i + 1) + '.jpeg'
              "
              [alt]="g"
              class="flex-shrink-0 w-80 h-80 rounded-lg object-cover snap-center transition-transform duration-300 hover:scale-105"
              (click)="slideshowSolo.open(i)"
            />
          </div>

          <!-- Slideshow for Solo Gallery -->
          <app-gallery-slideshow
            #slideshowSolo
            [images]="gallerySolo"
            basePath="assets/images/meeka-solo/"
          ></app-gallery-slideshow>
        </section>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div
    class="min-h-screen flex flex-col items-center justify-center gap-4 bg-[var(--secondary)] text-white"
  >
    <img
      src="../../assets/logo.png"
      alt="Memories logo"
      class="w-24 animate-pulse"
    />
    <p class="text-lg tracking-wide">Loading memories...</p>
  </div>
</ng-template>

<app-action-drawer
  [open]="drawerOpen"
  [name]="name"
  [caption]="caption"
  [imageSrc]="imageSrc"
  [testimonials]="testimonials"
  (close)="onClose()"
></app-action-drawer>

<app-gallery-slideshow #slideshow [images]="gallery"></app-gallery-slideshow>

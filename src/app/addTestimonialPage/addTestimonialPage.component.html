<div class="min-h-screen bg-slate-50 py-10">
  <div class="max-w-2xl mx-auto p-6">
    <h1 class="text-2xl font-semibold mb-4 text-slate-800">Share a memory</h1>

    <form [formGroup]="form" (ngSubmit)="openConfirm()" class="space-y-6">
      <!-- Name -->
      <div>
        <label class="block text-sm mb-1 text-slate-600">Your name</label>
        <input
          formControlName="author"
          type="text"
          class="w-full px-4 py-3 rounded-lg bg-white border border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-200 focus:outline-none text-slate-700 placeholder-slate-400 text-lg"
          placeholder="e.g. John Doe"
          autocomplete="name"
        />
        <div
          *ngIf="controls.author.touched && controls.author.invalid"
          class="text-xs text-red-500 mt-1"
        >
          Name is required (max 80 chars).
        </div>
      </div>

      <!-- Relationship -->
      <div>
        <label class="block text-sm mb-1 text-slate-600">Relationship</label>
        <input
          formControlName="relationShip"
          type="text"
          class="w-full px-4 py-3 rounded-lg bg-white border border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-200 focus:outline-none text-slate-700 placeholder-slate-400 text-lg"
          placeholder="e.g. Daughter, Friend"
          autocomplete="organization"
        />
        <div
          *ngIf="controls.relationShip.touched && controls.relationShip.invalid"
          class="text-xs text-red-500 mt-1"
        >
          Relationship is required.
        </div>
      </div>

      <!-- Memory -->
      <div>
        <label class="block text-sm mb-1 text-slate-600">Memory</label>
        <textarea
          formControlName="message"
          rows="6"
          class="w-full px-4 py-3 rounded-lg bg-white border border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-200 focus:outline-none text-slate-700 placeholder-slate-400 text-lg resize-y"
          placeholder="Write a short memory..."
        ></textarea>
        <div
          *ngIf="controls.message.touched && controls.message.invalid"
          class="text-xs text-red-500 mt-1"
        >
          Memory is required (max 2000 chars).
        </div>
      </div>

      <!-- Submit -->
      <div class="flex items-center gap-3 justify-center">
        <button
          type="submit"
          [disabled]="saving || form.invalid"
          class="w-full px-4 py-3 rounded-lg bg-violet-600 hover:bg-violet-500 disabled:opacity-60 text-white font-medium text-lg transition"
        >
          {{ saving ? "Saving..." : "Save Memory" }}
        </button>
      </div>
    </form>

    <!-- Feedback -->
    <div
      *ngIf="testimonialAddedSuccess === true"
      class="mt-6 p-4 rounded-lg bg-green-50 text-green-800 text-center"
    >
      {{ message }}
    </div>

    <div
      *ngIf="testimonialAddedSuccess === false"
      class="mt-6 p-4 rounded-lg bg-rose-50 text-rose-800 text-center"
    >
      {{ message }}
    </div>
  </div>
</div>

<!-- Modern confirmation modal -->
<!-- Testimonial-style confirmation modal -->
<div
  *ngIf="isConfirmOpen"
  class="fixed inset-0 z-50 flex items-center justify-center px-4 py-6"
  role="dialog"
  aria-modal="true"
  aria-labelledby="confirm-title"
  (click)="cancelConfirm()"
>
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/40 transition-opacity"></div>

  <!-- Testimonial card (clicks inside do not close) -->
  <div
    (click)="$event.stopPropagation()"
    class="relative w-full max-w-3xl mx-auto rounded-xl shadow-lg overflow-hidden ring-1 ring-black/10"
    role="document"
  >
    <!-- Testimonial preview (matches your snippet) -->
    <div
      class="w-full flex-shrink-0 p-12"
      [ngStyle]="{
        'background-color': 'var(--secondary, rgb(31,34,58))',
        color: 'var(--secondary, #f8fafc)'
      }"
      aria-live="polite"
    >
      <p
        class="text-lg md:text-xl italic text-white leading-relaxed whitespace-pre-wrap break-words"
      >
        “{{ pendingTestimonial?.message }}”
      </p>
      <p class="mt-4 text-sm font-medium text-white">
        — {{ pendingTestimonial?.author
        }}{{
          pendingTestimonial?.relationShip
            ? ", " + pendingTestimonial?.relationShip
            : ""
        }}
      </p>
    </div>

    <!-- Actions row -->
    <div class="flex items-center justify-end gap-3 bg-[var(--primary)] p-4">
      <button
        (click)="cancelConfirm()"
        class="px-4 py-2 rounded-md bg-transparent border border-gray-200 text-gray-800 hover:bg-gray-50 transition"
      >
        Cancel
      </button>

      <button
        #confirmButton
        (click)="confirmSave()"
        [disabled]="saving"
        class="px-5 py-2 rounded-md bg-violet-600 hover:bg-violet-500 text-white font-medium shadow"
      >
        {{ saving ? "Saving..." : "Confirm & Save" }}
      </button>
    </div>
  </div>
</div>
